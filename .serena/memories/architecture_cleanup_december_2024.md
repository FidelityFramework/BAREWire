# BAREWire Architecture Cleanup - December 2024

## Summary

Removed platform-specific implementations that were doing Alex's job in the wrong layer.

## Deleted Directories/Files

- `src/Platform/` (entire directory)
  - `Platform/Providers/` - Linux.fs, Windows.fs, MacOS.fs, Android.fs, iOS.fs, WebAssembly.fs, InMemory.fs
  - `Platform/Common/` - Interfaces.fs, Registry.fs, Resource.fs
  - `Platform/PlatformServices.fs`
- `src/IPC/` (entire directory) - SharedMemory.fs, MessageQueue.fs, NamedPipe.fs
- `src/Network/` (entire directory) - Frame.fs, Transport.fs, Protocol.fs
- `src/Core/Time/` (entire directory) - platform-specific time implementations

## Retained Structure

```
src/
├── Core/
│   ├── Types.fs      # BARE type system
│   ├── Memory.fs     # Memory abstractions
│   ├── Error.fs      # Error types
│   ├── Utf8.fs       # UTF-8 encoding
│   ├── Binary.fs     # Binary operations
│   ├── Uuid.fs       # UUID handling
│   └── Time.fs       # Time utilities (now uses Alloy.Primitives)
├── Memory/
│   ├── SafeMemory.fs # Safe memory operations
│   ├── Region.fs     # Region abstractions
│   ├── View.fs       # Memory views
│   └── Mapping.fs    # Core types only (MappingType, AccessType, MappingHandle)
├── Encoding/
│   ├── Encoder.fs    # BARE encoding
│   ├── Decoder.fs    # BARE decoding
│   └── Codec.fs      # Combined codec
└── Schema/
    ├── Definition.fs # Schema definitions
    ├── Validation.fs # Schema validation
    ├── Analysis.fs   # Schema analysis
    └── DSL.fs        # Schema DSL
```

## Corrected Architecture

### Before (Wrong)
```
BAREWire had Platform/Providers that implemented:
- mmap/munmap (Linux)
- VirtualAlloc/VirtualFree (Windows)
- Named pipes, shared memory, sockets
```

### After (Correct)
```
BAREWire provides:
- Abstract types (MappingType, AccessType, etc.)
- Schema system for binary data layouts
- Memory region/view abstractions

Alex provides (via Firefly compilation):
- Platform-specific implementations
- Bound to extern primitives like Alloy does
```

## Dependency Chain

```
BAREWire.Core ← pure abstractions, depends on Alloy
    ↓
BAREWire.[DeviceClass] ← generated by Farscape (future)
    ↓
Firefly/Alex ← provides platform bindings
```

## Build Note

BAREWire depends on Alloy which uses `.fidproj` format. For traditional
dotnet builds, either:
1. Create a shadow `Alloy.fsproj` for F# LSP indexing
2. Build BAREWire as part of Fidelity toolchain (via Firefly)
